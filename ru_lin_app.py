
import streamlit as st
import folium
from folium.plugins import MarkerCluster
import pandas as pd
import matplotlib.pyplot as plt


location_data = {
    "åœ°ç‚¹": ["å—äº¬", "æ­å·", "æ‰¬å·", "è‹å·", "æ¹–å·"],
    "çº¬åº¦": [32.041544, 30.279609, 32.393372, 31.299379, 30.876742],
    "ç»åº¦": [118.767413, 120.154857, 119.402997, 120.619585, 120.058594],
    "å‡ºç°é¢‘ç‡": [18, 15, 11, 8, 6],
    "æ ¸å¿ƒäººç‰©": ["é²ç¼–ä¿®ã€é™ˆå’Œç”«ã€è˜§å…¬å­™", "é©¬çº¯ä¸Šã€åŒ¡è¶…äººã€æ´ªæ†¨ä»™", "ç‰›å¸ƒè¡£ã€ç›å•†ä¸‡é›ªæ–‹", "è˜§å…¬å­™ã€ç‹æƒ ", "ç‰›å¸ƒè¡£ã€åŒ¡è¶…äºº"],
    "å…³é”®æ´»åŠ¨": [
        "ç§‘ä¸¾åº”è¯•ã€ç¿°æ—é™¢åº”é…¬ã€æ–‡äººèšä¼š",
        "é€‰ä¹¦è°‹ç”Ÿã€æ–‡äººæ¼«æ¸¸ã€ä¼ªåå£«äº¤å¾€",
        "å•†ä¸šåº”é…¬ã€æ–‡äººä¾é™„ã€å¼‚åœ°è°‹ç”Ÿ",
        "åœ°æ–¹æ–‡äººå¾€æ¥ã€å®˜åƒšå¸ä»»éšå±…",
        "æ–‡äººé¿ä¸–ã€è¯—æ–‡äº¤æµã€å¹•åƒšä»»èŒ"
    ]
}


chapter_location = {
    "ç« èŠ‚": [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
    "æ¶‰åŠåœ°ç‚¹": [
        "å—äº¬ã€è‹å·",
        "æ­å·ã€æ¹–å·",
        "æ­å·ã€æ‰¬å·",
        "æ‰¬å·ã€å—äº¬",
        "æ­å·ã€å—äº¬",
        "å—äº¬ã€è‹å·",
        "æ­å·ã€æ¹–å·",
        "æ‰¬å·ã€å—äº¬",
        "å—äº¬ã€æ­å·",
        "è‹å·ã€æ¹–å·",
        "å—äº¬ã€æ‰¬å·"
    ],
    "æ ¸å¿ƒæƒ…èŠ‚": [
        "è˜§å…¬å­™èµ´å—äº¬æ‹œè®¿é²ç¼–ä¿®",
        "é©¬çº¯ä¸Šåœ¨æ­å·é€‰ä¹¦ï¼Œé‡åŒ¡è¶…äºº",
        "åŒ¡è¶…äººä¾é™„æ´ªæ†¨ä»™ï¼Œæ¸¸æ‰¬å·",
        "ç‰›å¸ƒè¡£åœ¨æ‰¬å·ä¾é™„ç›å•†ä¸‡é›ªæ–‹",
        "é™ˆå’Œç”«åœ¨å—äº¬å¼•èè˜§å…¬å­™",
        "ç‹æƒ å¸ä»»åéšå±…è‹å·",
        "åŒ¡è¶…äººåœ¨æ¹–å·ä»»å¹•åƒš",
        "é²ç¼–ä¿®åœ¨å—äº¬ä¸»æŒç§‘ä¸¾åº”é…¬",
        "æ–‡äººåœ¨å—äº¬èšä¼šï¼Œè®ºè¯—ä½œæ–‡",
        "ç‰›å¸ƒè¡£åœ¨æ¹–å·é¿ä¸–ä½œè¯—",
        "åŒ¡è¶…äººèµ´å—äº¬åº”è¯•ï¼Œå¾—é²ç¼–ä¿®èµè¯†"
    ]
}

df_location = pd.DataFrame(location_data)
df_chapter = pd.DataFrame(chapter_location)


st.set_page_config(
    page_title="ã€Šå„’æ—å¤–å²ã€‹10-20ç« åœ°ç‚¹å¯è§†åŒ–",
    page_icon="ğŸ“œ",
    layout="wide"
)

st.title("ğŸ“œ ã€Šå„’æ—å¤–å²ã€‹10-20ç« åœ°ç‚¹é¢‘ç‡GISå¯è§†åŒ–åˆ†æ")
st.markdown("---")


st.subheader("ä¸€ã€åœ°ç‚¹é¢‘ç‡GISåœ°å›¾")
st.markdown("æ°”æ³¡å¤§å°å¯¹åº”åœ°ç‚¹å‡ºç°é¢‘ç‡ï¼Œç‚¹å‡»æ°”æ³¡æŸ¥çœ‹æ ¸å¿ƒäººç‰©ä¸æ´»åŠ¨")


m = folium.Map(
    location=[36.5786, 103.8198],
    zoom_start=5,
    tiles="CartoDB positron"  
)


marker_cluster = MarkerCluster().add_to(m)


for idx, row in df_location.iterrows():
    # æ°”æ³¡å¤§å°ä¸é¢‘ç‡æ­£ç›¸å…³ï¼ˆåŠå¾„=é¢‘ç‡Ã—2ï¼‰
    folium.CircleMarker(
        location=[row["çº¬åº¦"], row["ç»åº¦"]],
        radius=row["å‡ºç°é¢‘ç‡"] * 2,
        color="#1f77b4",
        fill=True,
        fill_color="#1f77b4",
        fill_opacity=0.6,
        popup=folium.Popup(
            f"""
            <strong>åœ°ç‚¹ï¼š{row["åœ°ç‚¹"]}</strong><br>
            å‡ºç°é¢‘ç‡ï¼š{row["å‡ºç°é¢‘ç‡"]}æ¬¡<br>
            æ ¸å¿ƒäººç‰©ï¼š{row["æ ¸å¿ƒäººç‰©"]}<br>
            å…³é”®æ´»åŠ¨ï¼š{row["å…³é”®æ´»åŠ¨"]}
            """,
            max_width=300
        )
    ).add_to(marker_cluster)


st.components.v1.html(m._repr_html_(), height=600)


st.markdown("---")
st.subheader("äºŒã€ç« èŠ‚-åœ°ç‚¹å¯¹åº”æŸ¥è¯¢")
selected_chapter = st.selectbox("é€‰æ‹©ç« èŠ‚", df_chapter["ç« èŠ‚"].unique())


chapter_info = df_chapter[df_chapter["ç« èŠ‚"] == selected_chapter].iloc[0]
st.markdown(f"**æ¶‰åŠåœ°ç‚¹**ï¼š{chapter_info['æ¶‰åŠåœ°ç‚¹']}")
st.markdown(f"**æ ¸å¿ƒæƒ…èŠ‚**ï¼š{chapter_info['æ ¸å¿ƒæƒ…èŠ‚']}")


st.markdown("---")
st.subheader("ä¸‰ã€æ ¸å¿ƒäººç‰©-åœ°ç‚¹å…³è”")


character_location = {
    "äººç‰©": ["é²ç¼–ä¿®", "é™ˆå’Œç”«", "è˜§å…¬å­™", "é©¬çº¯ä¸Š", "åŒ¡è¶…äºº", "æ´ªæ†¨ä»™", "ç‰›å¸ƒè¡£", "ä¸‡é›ªæ–‹", "ç‹æƒ "],
    "å…³è”åœ°ç‚¹": ["å—äº¬", "å—äº¬", "å—äº¬ã€è‹å·", "æ­å·", "æ­å·ã€æ¹–å·ã€å—äº¬", "æ­å·", "æ‰¬å·ã€æ¹–å·", "æ‰¬å·", "è‹å·"]
}
df_character = pd.DataFrame(character_location)


st.dataframe(df_character, use_container_width=True)


plt.rcParams['font.sans-serif'] = ['SimHei']  # è§£å†³ä¸­æ–‡æ˜¾ç¤ºé—®é¢˜
character_count = df_character["å…³è”åœ°ç‚¹"].str.split("ã€").str.len()
df_character["åœ°ç‚¹æ•°é‡"] = character_count

fig, ax = plt.subplots(figsize=(10, 6))
ax.bar(df_character["äººç‰©"], df_character["åœ°ç‚¹æ•°é‡"], color="#ff7f0e")
ax.set_xlabel("æ ¸å¿ƒäººç‰©", fontsize=12)
ax.set_ylabel("å…³è”åœ°ç‚¹æ•°é‡", fontsize=12)
ax.set_title("æ ¸å¿ƒäººç‰©å…³è”åœ°ç‚¹æ•°é‡ç»Ÿè®¡", fontsize=14)
ax.tick_params(axis='x', rotation=45)
st.pyplot(fig)


st.markdown("---")
st.subheader("å››ã€æ ¸å¿ƒæ´å¯Ÿ")
st.markdown("1. **å—äº¬**ï¼šç§‘ä¸¾ä¸å®˜åƒšä½“ç³»æ ¸å¿ƒï¼Œæ˜¯æ–‡äººè¿½æ±‚ä»•é€”çš„æ ¸å¿ƒç›®çš„åœ°ï¼Œå‡ºç°é¢‘ç‡æœ€é«˜ï¼ˆ18æ¬¡ï¼‰ã€‚")
st.markdown("2. **æ­å·ã€æ‰¬å·**ï¼šæ±Ÿå—ç»æµé‡é•‡ï¼Œæ˜¯æ— å®˜èŒæ–‡äººè°‹ç”Ÿï¼ˆé€‰ä¹¦ã€å¹•åƒšã€ä¾é™„å•†äººï¼‰çš„ä¸»è¦åœºåŸŸã€‚")
st.markdown("3. **è‹å·ã€æ¹–å·**ï¼šåœ°æ–¹æ–‡äººåœˆå±‚èšé›†åœ°ï¼Œä¾§é‡ç²¾ç¥é¿ä¸–ä¸è¯—æ–‡äº¤æµï¼Œåœºæ™¯æ›´ç§å¯†ã€‚")
st.markdown("4. äººç‰©æ´»åŠ¨ä¸åœ°ç‚¹å¼ºç»‘å®šï¼šä»•é€”ç›¸å…³é›†ä¸­å—äº¬ï¼Œè°‹ç”Ÿç›¸å…³é›†ä¸­æ­æ‰¬ï¼Œé¿ä¸–ç›¸å…³é›†ä¸­è‹æ¹–ã€‚")
